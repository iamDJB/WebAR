<!DOCTYPE html>
<html>
    <!-- Load external scripts -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>

    <!-- Add an additional script to handle video playback -->
    <script>
        var ar_video
        AFRAME.registerComponent('markerHandler', {
            init: function() {
                // Setup the tick throttling. This will check if the marker is active every 500ms.
                this.tick = AFRAME.utils.throttleTick(this.tick, 500, this);
            },

            tick: function(t, dt) {
                // Check if the marker is visible
                if (document.querySelector("#jafteaMarker").object3D.visible == true && playing == false) {
                    // Marker is visible
                    ar_video = document.querySelector("#vid");

                    // Toggle video playback on click
                    ar_video.addEventListener("click", function () { ToggleVideo(); });

                    // Play the video
                    playing = true;
                }
            }
        });

        function ToggleVideo() {
            if (ar_video.paused) { ar_video.play(); }
            else { ar_video.pause(); }
        };
    </script>
    
    <!-- Start body -->
    <body style="margin : 0px; overflow: hidden;">

        <!-- Asset management system -->
        <a-assets>            
            <!-- Video -->            
            <!-- <video src="assets/videos/jaftea-4s.mp4" preload="auto" id="vid" response-type="arraybuffer" loop crossorigin webkit-playsinline autoplay muted playsinline></video> -->
            <!-- <video src="assets/videos/jaftea-promo.mp4" preload="auto" id="vid" response-type="arraybuffer" loop crossorigin webkit-playsinline autoplay playsinline></video>     -->
            <video src="assets/videos/jaftea-promo.mp4" preload="auto" id="vid" response-type="arraybuffer" crossorigin webkit-playsinline autoplay playsinline></video>    
            <!-- Mug model -->
            <a-asset-item id="mug-obj" src="assets/models/mug.obj"></a-asset-item>
        </a-assets>
    
        <!-- Open AR.js scene -->
        <a-scene vr-mode-ui="enabled: false;" renderer="antialias: true; alpha: true; precision: mediump;" embedded arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        <!-- <a-scene arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;"> -->
        <!-- Note that matrixCodeType can be any one of [3x3, 3x3_HAMMING63, 3x3_PARITY65, 4x4, 4x4_BCH_13_9_3, 4x4_BCH_13_5_5] -->        

            <!-- Handle a marker with custom pattern -->
            <a-marker type="pattern" url="./assets/data/jaftea.patt">
                <!-- Video -->
                <a-entity>                    
                    <!-- <a-video src="#vid" position="0 0 0" rotation="-45 0 90" scale="0.95 0.95 0.95" play="true"></a-video> -->
                    <!-- <a-video src="#vid" position="0 0 0" rotation="-45 0 0" scale="0.95 0.95 0.95" play="false"></a-video> -->
                    <a-video src="#vid" position="0 0 0" rotation="-45 0 0" play="false"></a-video>
                </a-entity>
                <!-- Mug -->
                <!-- <a-entity obj-model="obj: #mug-obj" position="0 1 0"></a-entity> -->
                <a-entity
                    gltf-model="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/scene.gltf"
                    scale="5 5 5"
                    position="50 150 -100"
                    >
                </a-entity>
            </a-marker>

            <!-- handle marker with hiro preset -->
            <a-marker preset="hiro">
            <a-box position="0 0.5 0" material="color: green;"></a-box>
            </a-marker>

            <!-- handle barcode marker -->
            <a-marker type="barcode" value="5">
            <a-box position="0 0.5 0" material="color: blue;"></a-box>
            </a-marker>

            <!-- Add a simple camera -->
            <a-entity camera></a-entity>
        </a-scene>    
    
    </body>
</html>